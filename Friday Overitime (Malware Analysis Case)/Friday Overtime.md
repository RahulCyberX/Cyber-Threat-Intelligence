# #6: Malware Analysis Case ⚔️

@fridayovertime

SwiftSpend Finance opened a new ticket, raising concerns about potential malware threats. The finance company, known for its strict security measures, had stumbled upon something suspicious and requested immediate expert analysis.

As the only CTI Analyst on shift at **PandaProbe Intelligence**, I quickly took charge of the situation, fully aware of the seriousness of a potential breach at a financial institution. The ticket included multiple file attachments suspected to be malware samples.

With a focused mindset (and admittedly a strong desire to go home), I began the investigation process step by step:

1. **Secure Handling of Samples**
    - I downloaded the malware samples from the ticket while ensuring they were contained within a secure, isolated analysis environment to prevent any accidental execution or spread.
2. **Preliminary Automated Analysis**
    - I ran the samples through automated malware analysis tools. This gave me a quick overview of their characteristics, possible malware family classification, and any immediately flagged indicators of compromise (IOCs).
3. **Manual Deep-Dive Analysis**
    - I conducted a manual investigation to study the malware’s behavior.
    - This involved monitoring system changes, persistence mechanisms, and communication attempts.
    - I paid special attention to identifying command-and-control (C2) patterns and data exfiltration attempts.
4. **Threat Intelligence Correlation**
    - I correlated my findings with global threat intelligence databases.
    - This helped me identify whether the malware matched known signatures, behaviors, or attack campaigns attributed to specific threat actors.
5. **Comprehensive Reporting**
    - Finally, I compiled a detailed report for SwiftSpend Finance.
    - The report included:
        - My findings on the malware behavior and capabilities.
        - Mapped IOCs.
        - Recommended mitigation steps.
        - Recovery measures to ensure any potential threats were swiftly neutralized.

By following this process, I ensured that SwiftSpend Finance had the necessary insights and guidance to handle the potential malware incident effectively and maintain their strong security posture.

---

I logged into the DocIntel platform with the provided credentials (username, password). That’s when I saw the “*Latest documents from your subscription*” notice and was informed about a newly detected malicious malware sample.

![image.png](image.png)

I clicked the notification and was taken to the details page. I can see there is an attached ZIP file that I should download for investigation.

![image.png](image%201.png)

I unzip the file using the provided password via the terminal:

![image.png](image%202.png)

Listing the directory (`ls`) shows the extracted items. There is a file named `pRsm.dll`, which I will analyze.

My next step is to compute its SHA1 hash. I obtained it with the following command:

```jsx
sha1sum pRsm.dll
```

![image.png](image%203.png)

SHA1 hash = `9d1ecbbe8637fed0d89fca1af35ea821277ad2e8`

To identify the malware framework that `pRsm.dll` belongs to, I performed a targeted Google search which led me to an article on WeLiveSecurity:

[https://www.welivesecurity.com/2023/04/26/evasive-panda-apt-group-malware-updates-popular-chinese-software/](https://www.welivesecurity.com/2023/04/26/evasive-panda-apt-group-malware-updates-popular-chinese-software/)

![image.png](image%204.png)

From the article, I confirmed that the framework name used by this sample is **MgBot**.

Next, I searched the article for the DLL name `pRsm.dll` to determine which ATT&CK technique is associated with it; the site returned the relevant technique ID.

![image.png](image%205.png)

Ok so I have the ID now. But now I want to know the original download location (first seen on **2020-11-02**), I searched the article further and found it listed under the **Technical analysis** section.

![image.png](image%206.png)

I copied the download URL and defanged it using CyberChef (`https://gchq.github.io/CyberChef/`) with the Defang operation.

![image.png](image%207.png)

The defanged URL is:

`hxxp[://]update[.]browser[.]qq[.]com/qmbs/QQ/QQUrlMgr_QQ88_4296.exe`

Next, I looked for the C2 IP address that was first detected on **2020-09-14** by searching that date in the article.

![image.png](image%208.png)

So now we have the IP address of server, but we need to defang it. so let’s head over to CyberChef again and this time apply the **Defang IP Addresses** recipe.

I obtained the IP address, then defanged it using CyberChef’s **Defang IP Addresses** operation. At first the output did not change; I adjusted the formatting (removed brackets around the final dot) and the output became correctly defanged.

![image.png](image%209.png)

And thats the correct defanged IP address: `122[.]10[.]90[.]12`

To check whether any SpyAgent family spyware is associated with this IP, I submitted the defanged IP to VirusTotal (`https://www.virustotal.com/gui/`) and inspected the **Relations** tab.

I examined the different relation types associated with this IP. Under *Communicating files*, an **Android** entry stood out. I clicked the name to view details.

![image.png](image%2010.png)

On the **Details** tab, I can now see basic properties related to the file’s hash and related metadata.

![image.png](image%2011.png)